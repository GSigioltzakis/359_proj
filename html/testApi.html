<!DOCTYPE html>
<html>
<head>
    <title>Simple API Tester</title>
</head>
<body>
    <!--TEST FILE ONLY FOR THE API-->
    <h1>askisi 4: API Tester</h1>

    <div class="section">
        <h3>1.POST (Create Review)</h3>
        <input type="text" id="p_band" placeholder="Band Name" value="Cretan Waves">
        <input type="text" id="p_sender" placeholder="Your Name">
        <input type="text" id="p_text" placeholder="Review Text">
        <input type="number" id="p_rating" placeholder="Rating (1-5)" value="5">
        <button onclick="doPost()">Create Review</button>
    </div>

    <div class="section">
        <h3>3.GET (Search Reviews)</h3>
        <input type="text" id="g_band" placeholder="Band Name (or 'all')" value="Cretan Waves">
        <input type="number" id="g_from" placeholder="Rating From (Optional)">
        <input type="number" id="g_to" placeholder="Rating To (Optional)">
        <button onclick="doGet()">Get Reviews</button>
    </div>

    <div class="section">
        <h3>2.PUT (Update Status)</h3>
        <input type="text" id="u_id" placeholder="Review ID">
        <select id="u_status">
            <option value="published">published</option>
            <option value="rejected">rejected</option>
        </select>
        <button onclick="doPut()">Update Status</button>
    </div>

    <div class="section">
        <h3>4. DELETE (Remove Review)</h3>
        <input type="text" id="d_id" placeholder="Review ID">
        <button onclick="doDelete()">Delete Review</button>
    </div>

    <h3>Server Response:</h3>
    <div id="output">Waiting...</div>

    <script>
        const URL = 'http://localhost:3000';

        function log(data) {
            document.getElementById('output').innerText = JSON.stringify(data, null, 2);
        }
        async function doPost() {
            const data = {
                band_name: document.getElementById('p_band').value,
                sender: document.getElementById('p_sender').value,
                review: document.getElementById('p_text').value,
                rating: parseInt(document.getElementById('p_rating').value)
            };
            try {
                const res = await fetch(URL + '/review/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                const json = await res.json();
                log(json);
                //Auto-fill ID fields
                if(json.reviewId) {
                    document.getElementById('u_id').value = json.reviewId;
                    document.getElementById('d_id').value = json.reviewId;
                }
            } catch (e) { log(e); }
        }

        async function doGet() {
            const band = document.getElementById('g_band').value || 'all';
            const from = document.getElementById('g_from').value;
            const to = document.getElementById('g_to').value;
            let query = `?ratingFrom=${from}&ratingTo=${to}`;
            
            try {
                const res = await fetch(`${URL}/reviews/${band}${query}`);
                log(await res.json());
            } catch (e) { log(e); }
        }

        async function doPut() {
            const id = document.getElementById('u_id').value;
            const status = document.getElementById('u_status').value;
            try {
                const res = await fetch(`${URL}/reviewStatus/${id}/${status}`, {method: 'PUT'});
                log(await res.json());
            } catch (e) { log(e); }
        }

        async function doDelete() {
            const id = document.getElementById('d_id').value;
            try {
                const res = await fetch(`${URL}/reviewDeletion/${id}`, {method: 'DELETE'});
                log(await res.json());
            } catch (e) { log(e); }
        }
    </script>
</body>
</html>